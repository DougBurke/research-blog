<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta>
        <title>Doug's research blog - Checking the spectral fit</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css"></link>
    </head>
    <body>
        <h1>Doug's research blog - Checking the spectral fit</h1>
        <div id="navigation">
            <a href="../index.html">Home</a>
	    <a href="../intro.html">Introduction</a>
            <a href="../posts/">All posts</a>
	    <a href="../dictionary.html">Dictionary</a>
	    <a href="../acknowledge.html">Acknowledgements</a>
        </div>

	<div id="main">
        <div id="publisheddate">
<p>by <em>Douglas Burke</em> on <strong>2 November 2012</strong></p>
</div>

<div class="neighbours">
  <div class="previouspost"><a href="../posts/2012-11-01-spectrum3.html">Spectrum III - Third time's the charm</a><br /><span class="label">previous post</span></div>

</div>

<p>One concern I have when doing a fit - whether to spectra, images, or other data - is how sensitive are the results to the “initial conditions”, that is often thought of as the starting parameter values (which, as I will show below, can change things), but can also be thought of as the energy range used for the analysis (amongst other things).</p>
<h2 id="scripting-things">Scripting things</h2>
<p>To avoid too much typing, and keep things repeatable, I have combined yesterday’s analysis steps into the script <a href="../data/fit_group.py"><code>fit_group.py</code></a> that defines the Python function <code>dofit</code> with the following signature:</p>
<pre><code>% sherpa fit_group.py
-----------------------------------------------------
Welcome to Sherpa: CXC's Modeling and Fitting Package
-----------------------------------------------------
CIAO 4.4 Sherpa version 2 Tuesday, June 5, 2012

sherpa-2&gt; help(dofit)
Help on function dofit in module __main__:

dofit(elo=0.5, ehi=7.0, fixbgnd=True)
    Fit group.pi with an absorbed APEC model over the
    energy range elo to ehi (in keV) using the Cash statistic.
    The background is modeled as a powerlaw + thermal model
    (both absorbed), fitted separately, then fixed before
    fitting the source (unless fixbgnd is False).
</code></pre>
<p>As a check I run it with no arguments, so that it should repeat <a href="../posts/2012-11-01-spectrum3.html">yesterday’s fit</a>:</p>
<pre><code>sherpa-3&gt; dofit()
***
*** Fix bgnd before source fitting: True
*** Energy range: 0.5 to 7.0 keV
***
read ARF file group.warf
read RMF file group.wrmf
read ARF (background) file group_bkg.warf
read RMF (background) file group_bkg.wrmf
read background file group_bkg.pi
*** Fitting background
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 2.61968e+07
Final fit statistic   = 703.056 at function evaluation 343
Data points           = 446
Degrees of freedom    = 444
Change in statistic   = 2.61961e+07
   bgnd.gamma     0.551107    
   bgnd.ampl      4.72044e-05 
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 703.056
Final fit statistic   = 703.056 at function evaluation 290
Data points           = 446
Degrees of freedom    = 444
Change in statistic   = 0
   bgnd.gamma     0.551107    
   bgnd.ampl      4.72044e-05 
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 2.78615e+06
Final fit statistic   = 500.503 at function evaluation 1250
Data points           = 446
Degrees of freedom    = 442
Change in statistic   = 2.78565e+06
   bgnd.gamma     -0.0255636  
   bgnd.ampl      2.25478e-05 
   gal.kT         0.1954      
   gal.norm       0.000100323 
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 500.503
Final fit statistic   = 500.503 at function evaluation 629
Data points           = 446
Degrees of freedom    = 442
Change in statistic   = 0
   bgnd.gamma     -0.0255636  
   bgnd.ampl      2.25478e-05 
   gal.kT         0.1954      
   gal.norm       0.000100323 
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 500.503
Final fit statistic   = 496.268 at function evaluation 1568
Data points           = 446
Degrees of freedom    = 441
Change in statistic   = 4.2347
   bgnd.gamma     -0.0738507  
   bgnd.ampl      2.10531e-05 
   gal.kT         0.196389    
   gal.Abundanc   0.022431    
   gal.norm       0.00218217  
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 496.268
Final fit statistic   = 496.268 at function evaluation 707
Data points           = 446
Degrees of freedom    = 441
Change in statistic   = 1.45236e-07
   bgnd.gamma     -0.0738574  
   bgnd.ampl      2.1053e-05  
   gal.kT         0.196388    
   gal.Abundanc   0.0224329   
   gal.norm       0.00218218  
*** Freezing background
*** Fitting source
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 8.13846e+06
Final fit statistic   = 755.432 at function evaluation 306
Data points           = 892
Degrees of freedom    = 890
Change in statistic   = 8.13771e+06
   grp.kT         2.03504     
   grp.norm       2.58263e-05 
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 755.432
Final fit statistic   = 755.432 at function evaluation 279
Data points           = 892
Degrees of freedom    = 890
Change in statistic   = 0
   grp.kT         2.03504     
   grp.norm       2.58263e-05 
grp.norm lower bound:	-5.95703e-06
grp.norm upper bound:	4.06683e-06
grp.kT lower bound:	-0.529801
grp.kT upper bound:	0.520638
Dataset               = 1
Confidence Method     = confidence
Iterative Fit Method  = None
Fitting Method        = neldermead
Statistic             = cash
confidence 1-sigma (68.2689%) bounds:
   Param            Best-Fit  Lower Bound  Upper Bound
   -----            --------  -----------  -----------
   grp.kT            2.03504    -0.529801     0.520638
   grp.norm      2.58263e-05 -5.95703e-06  4.06683e-06
*** now allowing metallicity to vary
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 755.432
Final fit statistic   = 750.072 at function evaluation 494
Data points           = 892
Degrees of freedom    = 889
Change in statistic   = 5.3606
   grp.kT         1.32712     
   grp.Abundanc   0.113515    
   grp.norm       5.20994e-05 
Dataset               = 1
Method                = neldermead
Statistic             = cash
Initial fit statistic = 750.072
Final fit statistic   = 750.072 at function evaluation 423
Data points           = 892
Degrees of freedom    = 889
Change in statistic   = 1.7603e-07
   grp.kT         1.32725     
   grp.Abundanc   0.113492    
   grp.norm       5.21016e-05 
grp.kT lower bound:	-0.225755
grp.norm lower bound:	-1.37811e-05
grp.kT upper bound:	0.402842
grp.Abundanc lower bound:	-0.0887834
grp.Abundanc upper bound:	0.181328
grp.norm upper bound:	1.67819e-05
Dataset               = 1
Confidence Method     = confidence
Iterative Fit Method  = None
Fitting Method        = neldermead
Statistic             = cash
confidence 1-sigma (68.2689%) bounds:
   Param            Best-Fit  Lower Bound  Upper Bound
   -----            --------  -----------  -----------
   grp.kT            1.32725    -0.225755     0.402842
   grp.Abundanc     0.113492   -0.0887834     0.181328
   grp.norm      5.21016e-05 -1.37811e-05  1.67819e-05</code></pre>
<p><a href="../data/fit-source-bgnd-0.5-7.0.txt">Full screen output</a></p>
<p>So, the fit results are <em>slightly</em> different to those from yesterday, namely</p>
<pre><code>confidence 1-sigma (68.2689%) bounds:
   Param            Best-Fit  Lower Bound  Upper Bound
   -----            --------  -----------  -----------
   grp.kT            1.29172    -0.171804     0.390972
   grp.Abundanc    0.0932278   -0.0683859     0.183778
   grp.norm      5.19229e-05 -1.53405e-05  1.63004e-05</code></pre>
<p>and it is actually a a <em>slightly-better</em> fit, since the fit statistic here is <code>750.072</code> versus <code>750.483</code> from yesterday. However, note that the fit results are actually very similar if you look at how different they are in terms of the error (e.g. the temperature difference is <span class="math"> ∼ 0. 04</span> keV, which is a lot smaller than the <span class="math"> ∼ 0. 2</span> keV error), as expected since the difference in the <a href="http://cxc.harvard.edu/sherpa/ahelp/cash.html">Cash statistic</a> is <span class="math"> ∼ 0. 4</span> (since the difference in Cash statistic can be equated to the <span class="math"><em>δ</em><em>χ</em><sup>2</sup></span> distribution, this is less than a <span class="math">1<em>σ</em></span> change).</p>
<p>Why the difference? Well, yesterday I ended up with a slightly-different set of background parameters because I did not change the gas temperature of the <code>gal</code> component before fitting (so yesterday it started at 1 keV but the script changes this to 0.2 keV). This results in the difference seen above.</p>
<p>I have also created a command <code>doplot</code> that shows the source and background fits (it customises the default Sherpa plot hence the need for a command):</p>
<pre><code>sherpa-4&gt; doplot()
WARNING: unable to calculate errors using current statistic: cash
WARNING: unable to calculate errors using current statistic: cash
sherpa-5&gt; print_window('fit-source-bgnd-0.5-7.0.png')</code></pre>
<div class="figure">
<img src="../images/fit-source-bgnd-0.5-7.0.png" alt="The top plot shows the source fit and the bottom plot the background fit when using the 0.5 to 7.0 keV range."></img><p class="caption">The top plot shows the source fit and the bottom plot the background fit when using the 0.5 to 7.0 keV range.</p>
</div>
<h3 id="expanding-the-energy-range">Expanding the energy range</h3>
<p>There is valid ACIS-I data outside the energy range 0.5 to 7.0 keV but I did not use it because</p>
<ul>
<li><p>the sensitivity drops strongly outside this energy range so it is unlikely to add much to the analysis;</p></li>
<li><p>the background level increases (in particular at higher energies);</p></li>
<li><p>the calibration is not as accurate, in particular below 0.5 keV.</p></li>
</ul>
<p>However, I am going to try changing the energy range to see what happens; first by using the 0.3 to 8.0 keV range. I have not included the full screen output, as I did above, for these runs, but they are available for download.</p>
<p>First I compare the source spectrum to the sensitivity of the detector, as measured by the <a href="http://cxc.harvard.edu/ciao/dictionary/arf.html">ARF</a>:</p>
<pre><code>sherpa-6&gt; plot_source()
sherpa-7&gt; add_axis(Y_AXIS, 1, 0, 1)
sherpa-8&gt; plot_arf(overplot=True)
sherpa-9&gt; set_histogram(['line.color', 'default'])
sherpa-10&gt; set_plot_ylabel('ARF (cm^{-2})')
sherpa-11&gt; current_axis('ay1')
sherpa-12&gt; set_yaxis(['offset.perpendicular', 60])
sherpa-13&gt; log_scale(Y_AXIS)
sherpa-14&gt; current_axis('ay2')
sherpa-15&gt; log_scale(Y_AXIS)
sherpa-16&gt; add_vline(0.5, ['style', 'longdash', 'color', 'blue'])
sherpa-17&gt; add_vline(7.0, ['style', 'longdash', 'color', 'blue'])
sherpa-18&gt; set_axis('all', ['label.size', 18])
sherpa-19&gt; set_plot_title(r'\color{red}Source spectrum  \color{default}ARF')
sherpa-20&gt; print_window('source-arf.png')</code></pre>
<div class="figure">
<img src="../images/source-arf.png" alt="The red line shows the source spectrum (before it enters the telescope) in red, and the effective area (aka ARF) in black. Both are drawn with a logarithmic scale on the ordinate axis. The two vertical lines show the position of the 0.5 and 7.0 keV energies; outside these values the combination of source * ARF drops quickly."></img><p class="caption">The red line shows the source spectrum (before it enters the telescope) in red, and the effective area (aka ARF) in black. Both are drawn with a logarithmic scale on the ordinate axis. The two vertical lines show the position of the 0.5 and 7.0 keV energies; outside these values the combination of <code>source * ARF</code> drops quickly.</p>
</div>
<h3 id="to-8.0-kev">0.3 to 8.0 keV</h3>
<p>So, now the 0.3 to 8.0 keV results (done using a new Sherpa session just to make sure that there is no problem with some setting from the previous analysis affecting the results):</p>
<pre><code>% sherpa 
sherpa fit_group.py 
-----------------------------------------------------
Welcome to Sherpa: CXC's Modeling and Fitting Package
-----------------------------------------------------
CIAO 4.4 Sherpa version 2 Tuesday, June 5, 2012

sherpa-2&gt; dofit(elo=0.3, ehi=8.0)
***
*** Fix bgnd before source fitting: True
*** Energy range: 0.3 to 8.0 keV
***
...
confidence 1-sigma (68.2689%) bounds:
   Param            Best-Fit  Lower Bound  Upper Bound
   -----            --------  -----------  -----------
   grp.kT            1.31973    -0.223513     0.375792
   grp.Abundanc     0.147555    -0.103724     0.201604
   grp.norm      4.76816e-05 -1.36144e-05  1.59915e-05
sherpa-4&gt; doplot()
WARNING: unable to calculate errors using current statistic: cash
WARNING: unable to calculate errors using current statistic: cash
sherpa-5&gt; print_window('fit-source-bgnd-0.3-8.0.png')
sherpa-6&gt; quit()</code></pre>
<p><a href="../data/fit-source-bgnd-0.3-8.0.txt">Full screen output</a></p>
<div class="figure">
<img src="../images/fit-source-bgnd-0.3-8.0.png" alt="The background can be seen to increase below 0.5 keV and above 7.0 keV, although in reality the change is not huge."></img><p class="caption">The background can be seen to increase below 0.5 keV and above 7.0 keV, although in reality the change is not huge.</p>
</div>
<p>The background model has struggled to account for the new data; not shown in the output elided above is the fact that the temperature of the <code>gal</code> component is stuck at it’s minimum temperature (<span class="math"> ∼ 0. 1</span> keV) and abundance (0). Overall the source parameters or their errors are not significantly different.</p>
<h3 id="to-5.0-kev">0.6 to 5.0 keV</h3>
<pre><code>% sherpa fit_group.py
-----------------------------------------------------
Welcome to Sherpa: CXC's Modeling and Fitting Package
-----------------------------------------------------
CIAO 4.4 Sherpa version 2 Tuesday, June 5, 2012

sherpa-2&gt; dofit(0.6, 5)
***
*** Fix bgnd before source fitting: True
*** Energy range: 0.6 to 5 keV
***
...
confidence 1-sigma (68.2689%) bounds:
   Param            Best-Fit  Lower Bound  Upper Bound
   -----            --------  -----------  -----------
   grp.kT            1.59163    -0.411918      0.48481
   grp.Abundanc     0.156599    -0.132078     0.261328
   grp.norm       4.6979e-05 -1.25465e-05  1.96818e-05
sherpa-3&gt; doplot()
WARNING: unable to calculate errors using current statistic: cash
WARNING: unable to calculate errors using current statistic: cash
sherpa-4&gt; print_window('fit-source-bgnd-0.6-5.0.png')
sherpa-5&gt; quit()</code></pre>
<p><a href="../data/fit-source-bgnd-0.6-5.0.txt">Full screen output</a></p>
<div class="figure">
<img src="../images/fit-source-bgnd-0.6-5.0.png" alt="The reduction in energy range means that the single power law component appears to be a better fit to the background"></img><p class="caption">The reduction in energy range means that the single power law component appears to be a better fit to the background</p>
</div>
<p>The <code>gal</code> component of the background has an unphysical abundance of <span class="math"> ∼ 10</span> times solar in this fit, but the results overall remain the same. Note that the reduction in the high-energy limit could correspond to the slight increase in best-fit temperature, since there is less of a constraint, but I am probably reading too much into the small changes.</p>
<h2 id="the-takeaway-message">The takeaway message?</h2>
<p>It looks like the exact choice of energy range used in the analysis does not significantly influence the results. Now, that’s not to say that this is done and dusted, since I havent’ proved that the emission is actually from a thermal plasma, since I haven’t tried fitting anything else to it!</p>



<div class="neighbours">
  <div class="previouspost"><a href="../posts/2012-11-01-spectrum3.html">Spectrum III - Third time's the charm</a><br /><span class="label">previous post</span></div>

</div>

	</div>
	  
	<div id="disqus_thread"></div>
	<script type="text/javascript">
            var disqus_shortname = 'dougsresearchblog';
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
	<!--
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        -->
	<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

	<div class="jumptostart">
	  <a href="#">Jump to top</a>
	</div>
	
	<div class="license">
	  All content © Douglas Burke 2012.<br>
	  <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/88x31.png"></img></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US">Creative
	  Commons Attribution 3.0 Unported License</a>.
	</div>

    </body>
</html>
